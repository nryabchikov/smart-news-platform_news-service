# Инструкция для приложения _Smart News Platform_

## Описание

Это приложение состоит из трех микросервисов: **User**, **Comment**, и **News**, а также использует **Keycloak** для управления аутентификацией и авторизацией пользователей с применением **OAuth2**. Каждый микросервис выполняет свою задачу и взаимодействует с другими через REST API.

## Структура приложения

- [user-service](https://github.com/nryabchikov/smart-news-platform_user-service)
- [comment-service](https://github.com/nryabchikov/smart-news-platform_comment-service)
- [news-service](https://github.com/nryabchikov/smart-news-platform_news-service)
- [keycloak](https://github.com/nryabchikov/smart-news-platform_news-service/blob/develop/config/keycloak/import/keycloak.json)

## Установка и запуск

### 1. Настройка Keycloak

**Keycloak** будет использоваться для управления пользователями и аутентификацией. Контейнер с Keycloak настраивается через `docker-compose`, который находится в папке `news-service`.

1. Запустите Keycloak с помощью следующей команды в директории `news-service`:

   ```bash
   cd news-service
   docker-compose up -d
   ```

2. После запуска Keycloak откройте браузер и перейдите по адресу `http://localhost:8082`. Войдите с использованием учетных данных `admin`/`admin`.

3. Импортируйте realm из `news-service/config/keycloak/import/keycloak.json`. Это можно сделать автоматически с помощью Docker, при запуске контейнера Keycloak.

4. В Keycloak уже созданы три пользователя:
   - **nekitos4** (роль: админ)
   - **pashok4** (роль: журналист)
   - **tolik4** (роль: подписчик)

   Вы можете использовать этих пользователей для тестирования или создать свои.

### 2. Установка и запуск сервисов

**Важно:** Микросервисы `news-service` и `comment-service` не удалось интегрировать с Keycloak в Docker, поэтому для этих сервисов Docker не используется.

#### a. Сервис User

Сервис отвечает за управление пользователями.

1. Перейдите в директорию сервиса:

   ```bash
   cd user-service
   docker-compose up -d
   ```

#### b. Сервис Comment и c. Сервис News

Для `comment-service` и `news-service` необходимо запустить их локально без использования Docker. Соберите и запустите каждый сервис.

1. Перейдите в директорию для сборки:

   ```bash
   cd comment-service
   ```

2. Соберите и запустите сервис с помощью Gradle.

3. Также выполните те же шаги для `news-service`.

### 3. Управление базой данных

Базу данных можно поднять с помощью Docker. Используйте файл `docker-compose` для настройки и развертывания базы данных PostgreSQL.

### 4. Документация и тестирование

- **News-service** полностью продокументирован с помощью Javadoc.
- Контроллеры также описаны в Swagger, что обеспечивает интерактивную документацию API.
- Написаны юнит-тесты для адаптеров, сервисов, а также тесты на основе Spring Data JPA для репозиториев и WebMVC и SpringBoot для контроллеров.

## 5. Роли и пользователи в Keycloak

В Keycloak созданы три роли:

1. **Админ**
2. **Журналист**
3. **Подписчик**

Вы можете просмотреть и управлять ролями через административную панель Keycloak. Также вы можете добавлять новых пользователей и назначать им роли прямо через интерфейс управления.

### 6. Кеширование

Кеширование можно настроить через файл `application.yml`, где вы можете указать тип кеша (lru или lfu) и максимальный размер кеша.

### 7. Интерфейс пользователя

Для пользователя интерфейс приложения доступен через Swagger, который предоставляет удобный способ взаимодействия с API.

## Заключение

Теперь ваше приложение готово к использованию. Вы можете добавлять пользователей, комментировать статьи и управлять новостями через соответствующие REST API.